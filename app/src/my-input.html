<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="elements/paper-time-picker.html">
<link rel="import" href="elements/menu-overlay.html">
<link rel="import" href="elements/paper-clock-selector.html">
<link rel="import" href="elements/simple-menu.html">
<link rel="import" href="elements/simple-menubar.html">
<link rel="import" href="elements/my-animatable.html">
<link rel="import" href="elements/my-animatable-triangle.html">
<link rel="import" href="my-icons.html">
<link rel="import" href="../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="../bower_components/polymerfire/firebase-app.html">
<!-- <link rel="import" href="../bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html"> -->
<!-- <link rel="import" href="my-toolbar.html"> -->
<!-- <link rel="import" href="my-login.html"> -->
<link rel="import" href="colors-material.html">
<!-- <link rel="import" href="toolbar-behavior.html"> -->
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<dom-module id="my-input">

  <template>
<style>
      :host {
        display: block;
        padding: 10px;
      }

    simple-menu,
    simple-menubar {
      display: inline-block;
      width: 100%;
    }

    simple-menu a {
      display: block;
    }

    simple-menubar a,
    simple-menu a {
      padding: 15px 20px;
      color: var(--primary-text-color);
      text-decoration: none;
    }

    paper-time-picker {
        @apply(--layout-center-justified);
        /*@apply(--layout-horizontal);*/
    }

    p.heading {
      color: var(--app-primary-color);
      text-decoration: none;
      margin-bottom:0px;
    }

    simple-menu a[disabled],
    simple-menubar a[disabled] {
      color: var(--google-grey-300);
    }

    a {
      color: white;
      border-style: solid;
      border-width: 1px;
      font-size: 13px;
      text-align: center;
      margin: 2px;
    }

    a.sleep {
      border-color: var(--paper-green-500);
      background-color: var(--paper-green-500);
    }

    a.gym {
      background-color: var(--paper-pink-500);
      border-color: var(--paper-pink-500);
    }

    a.social {
      border-color: var(--paper-amber-500);
      background-color: var(--paper-amber-500);
    }

    a.leisure {
      border-color: var(--paper-purple-500);
      background-color: var(--paper-purple-500);
    }

    a.work {
      border-color: var(--paper-blue-500);
      background-color: var(--paper-blue-500);
    }

    paper-button {
      color: white;
      border-style: solid;
      border-width: 1px;
      font-size: 13px;
      text-align: center;
      margin-bottom: 10px;
      --paper-button-raised-keyboard-focus: {
        background-color: var(--paper-pink-a200) !important;
        color: white !important;
      };
    }

    paper-button.sleep {
      border-color: var(--paper-green-500);
      background-color: var(--paper-green-500);
    }

    paper-button.gym {
      background-color: var(--paper-pink-500);
      border-color: var(--paper-pink-500);
    }

    paper-button.social {
      border-color: var(--paper-amber-500);
      background-color: var(--paper-amber-500);
    }

    paper-button.leisure {
      border-color: var(--paper-purple-500);
      background-color: var(--paper-purple-500);
    }

    paper-button.work {
      border-color: var(--paper-blue-500);
      background-color: var(--paper-blue-500);
    }
    
    paper-button.sleep[selected] {
      background-color: var(--paper-red-700);
    }

    .horizontal-section {
      padding: 0;
      margin-bottom: 20px;
    }

    .row {
      height: 100px;
    }

    .menuitem-floating {
      float:left; 
      display:inline;
      margin: 20px;
    }

    .white {
      /*background-color: var(--primary-background-color);*/
    }

    .with-margin {
          margin: 24px 40px;
        }

    .scrollable {
          border: 1px solid lightgray;
          padding: 24px;
          @apply(--layout-scroll);
        }
    </style>

    <div id="scope">
            <paper-time-picker id="picker" class="horizontal layout" period-start-selected="{{periodStartSelected}}" period-end-selected="{{periodEndSelected}}">
            </paper-time-picker>
<!--               <div class="white horizontal layout center-justified">
              <paper-button class="work">Work</paper-button>
              <paper-button class="sleep">Sleep</paper-button>
              <paper-button class="gym">Gym</paper-button>
              <paper-button class="social">Social</paper-button>
              <paper-button class="leisure">Leisure</paper-button>
              </div> -->
            <div class="horizontal layout center-justified">
              <simple-menubar class="horizontal layout center-justified" selected="{{activity}}" id="activitySelection" attr-for-selected="name" fallback-selection="Work">
              <!-- <div > -->
                <paper-button class="work" role="menuitem" name="Work">Work</paper-button>
                <paper-button class="sleep" role="menuitem" name="Sleep">Sleep</paper-button>
                <paper-button class="gym" role="menuitem" name="Gym">Gym</paper-button>
                <paper-button class="social" role="menuitem" name="Social">Social</paper-button>
                <paper-button class="leisure" role="menuitem" name="Leisure">Leisure</paper-button>
              <!-- </div> -->
              </simple-menubar>
            </div>
    </div>

    <firebase-document
        id="activityFirebase"
        app-name="notes"
        path="/"
        data="{{activityDetails}}">
    </firebase-document>
    <firebase-document
        id="createAggregateFirebase"
        app-name="notes"
        path="/"
        data="{{newAggregateDetails}}">
    <firebase-document
        id="updateAggregateFirebase"
        app-name="notes"
        path="/"
        data="{{updateAggregateDetails}}">
    </firebase-document>
    <firebase-document
        id="deleteActivityFirebase"
        app-name="notes"
        path="{{pathDelete}}">
    </firebase-document>
    
    <firebase-document
        id="editActivity"
        app-name="notes"
        path="/"
        data="{{editedActivityDetails}}">
    </firebase-document>

    <colors-material id="colorSheet"></colors-material>
    <menu-overlay no-cancel-on-outside-click id="plain" tabindex="-1" class="with-margin scrollable">
    <div style="padding-bottom: 40px;">    
      <paper-icon-button icon="icons:close" style="float: left;" on-tap="_closePopUp"></paper-icon-button>
      <paper-icon-button icon="icons:check" style="float: right;" on-tap="_saveSelection"></paper-icon-button>
    </div>
    <div class="scrollable">
      <p style="text-align: center;">{{periodStartSelected}} pm to {{periodEndSelected}} pm</p>
      <p class="heading">Select Activity</p><hr style="margin-bottom:20px;">
      <!-- <div class="horizontal-section-container"> -->
        <div>
          <!-- <div class="row"> -->
            <div class="horizontal layout center-justified wrap">
              <simple-menubar selected="{{activity}}" id="activitySelection" attr-for-selected="name" fallback-selection="Work">
                <paper-button class="work" role="menuitem" name="Work">Work</paper-button>
                <paper-button class="sleep" role="menuitem" name="Sleep">Sleep</paper-button>
                <paper-button class="gym" role="menuitem" name="Gym">Gym</paper-button>
                <paper-button class="social" role="menuitem" name="Social">Social</paper-button>
                <paper-button class="leisure" role="menuitem" name="Leisure">Leisure</paper-button>
              </simple-menubar>
            </div>
          <!-- </div> -->
        </div>
      <!-- </div> -->
      <p class="heading">Select Emotion</p><hr style="margin-bottom:20px;">
      <div class="horizontal layout justified wrap">
      <my-animatable id="joyInput" class="menuitem-floating" emotion="Joy" score={{joyScore}} on-down="_onJoyDown" on-up="_onJoyUp" pressed="{{joyPressed}}"></my-animatable>
      <my-animatable id="hopeInput" class="menuitem-floating" emotion="Hope" score={{hopeScore}} on-down="_onHopeDown" on-up="_onHopeUp" pressed="{{hopePressed}}"></my-animatable>
      <my-animatable id="calmInput" class="menuitem-floating" emotion="Calm" score={{calmScore}} on-down="_onCalmDown" on-up="_onCalmUp" pressed="{{calmPressed}}"></my-animatable>
      <my-animatable-triangle id="sorrowInput" class="menuitem-floating" emotion="Sorrow" score={{sorrowScore}} on-down="_onSorrowDown" on-up="_onSorrowUp"  pressed="{{sorrowPressed}}"></my-animatable-triangle>
      <my-animatable-triangle id="fearInput" class="menuitem-floating" emotion="Fear" score={{fearScore}} on-down="_onFearDown" on-up="_onFearUp" pressed="{{fearPressed}}"></my-animatable-triangle>
      <my-animatable-triangle id="angerInput" class="menuitem-floating" emotion="Anger" score={{angerScore}} on-down="_onAngerDown" on-up="_onAngerUp"  pressed="{{angerPressed}}"></my-animatable>
      </div>
    </div>
    </menu-overlay>

  </template>

  <script>

    Polymer({

      is: 'my-input',

      behaviors: [
        Polymer.NoteAppBehavior
      ],

      properties: {
          datadb: {
          type: Object,
          observer: 'dataChanged'
          },
          user: {
            type: String,
            value: '' 
          },
          periodEndSelected: {
            type: Number,
            value: 0,
            notify: true,
            observer: '_periodEndChanged' 
          },
          periodStartSelected: {
            type: Number,
            value: 0,
            notify: true,
            observer: '_periodStartChanged' 
          },
          activity: {
            type: String,
            reflectToAttribute: true,
            observer: '_activityChanged' 
          },
          activityDetails: {
            type: Object,
            reflectToAttribute: true
          },
          newAggregateDetails: {
            type: Object,
            reflectToAttribute: true
          }, 
          tempAggregateDetails: {
            type: Object,
            reflectToAttribute: true
          }, 
          aggregatedb: {
            type: Object,
            observer: 'aggregateDetailsChanged'
          },
          editedActivityDetails: {
            type: Object,
            reflectToAttribute: true
          },          
          activityList: {
            type: Array,
            value: [],
            observer: '_activityListChanged' 
          },
          joyScore: {
            type: Number,
            value: 0,
            observer: '_joyScoreChanged'
          },
          hopeScore: {
            type: Number,
            value: 0,
            observer: '_hopeScoreChanged'
          },
          calmScore: {
            type: Number,
            value: 0,
            observer: '_calmScoreChanged'
          },
          fearScore: {
            type: Number,
            value: 0,
            observer: '_fearScoreChanged'
          },
          sorrowScore: {
            type: Number,
            value: 0,
            observer: '_sorrowScoreChanged'
          },
          angerScore: {
            type: Number,
            value: 0,
            observer: '_angerScoreChanged'
          },
          angerScore: {
            type: Number,
            value: 0,
            observer: '_angerScoreChanged'
          },
          angerPressed: {
            type: Boolean,
            value: false,
          },
          calmPressed: {
            type: Boolean,
            value: false,
          },
          joyPressed: {
            type: Boolean,
            value: false,
          },
          sorrowPressed: {
            type: Boolean,
            value: false,
          },
          fearPressed: {
            type: Boolean,
            value: false,
          },
          hopePressed: {
            type: Boolean,
            value: false,
          },
          newDayExists: {
            type: Boolean,
            value: false,
          },
          emotions: {
            type: Array,
            value: 
            ["joy", "calm", "hope", "sorrow", "anger", "fear"]
          },
          positiveNegativeEmotion: {
            type: Object,
            value: 
            {"joy": 1, "calm" : 1, "hope": 1, "sorrow": -1, "anger": -1, "fear": -1}
          },
          activities: {
            type: Array,
            value: 
            ["Work", "Sleep", "Leisure", "Social", "Gym"]
          },
      },
      observers: [
           'dataChanged(datadb.*)',
           'aggregateDetailsChanged(aggregatedb.*)'
      ],
      _onAngerUp: function(){
        this.angerPressed = false;
      },
      _onCalmUp: function(){
        this.calmPressed = false;
      },
      _onJoyUp: function(){
        console.log("joy up");
        this.joyPressed = false;
        // this.$.joyInput.onUp();
      },
      _onFearUp: function(){
        this.fearPressed = false;
      },
      _onHopeUp: function(){
        this.hopePressed = false;
      },
      _onAngerDown: function(){
        this.angerPressed = true;
      },
      _onCalmDown: function(){
        this.calmPressed = true;
      },
      _onJoyDown: function(){
        console.log("joy down");
        this.joyPressed = true;
      },
      _onFearDown: function(){
        this.fearPressed = true;
      },
      _onHopeDown: function(){
        this.hopePressed = true;
      },
      _onSorrowUp: function(){
        this.sorrowPressed = false;
      },
      _onSorrowDown: function(){
        this.sorrowPressed = true;
      },
      aggregateDetailsChanged: function(aggregatedb) {
        console.log("aggregatedb: ");
        console.log(this.aggregatedb);
        var aggregateData = this.aggregatedb;
        this.tempAggregateDetails = {}; 
        var that = this;
        aggregateData.forEach(function(childSnapshot) {
          var key = childSnapshot.$key;
          if (key === "activities") {
          that.tempAggregateDetails.activities = {};
            for (var i=0; i<that.activities.length;i++) {
              var activityName = that.activities[i];
              that.tempAggregateDetails.activities[activityName] = childSnapshot[activityName];
            }
          }
          else if (key === "emotions") {
            that.tempAggregateDetails.emotions = {};
            for (var i=0; i<that.emotions.length;i++) {
              var emoName = that.emotions[i];
              that.tempAggregateDetails.emotions[emoName] = childSnapshot[emoName];
            }
          }
        });
        this.updateAggregateDetails = this.tempAggregateDetails;
        console.log("updateAggregateDetails");
        console.log(this.updateAggregateDetails);
        // console.log(aggregatedb);
        // var aggregateEmotions;
        // var aggregateActivities;
        // if (aggregatedb) {
        //   this.aggregateDataExists = true;
        //   console.log(aggregatedb.activities);
        //   aggregatedb.forEach(function(arrayObject) {
        //     arrayObject.object.forEach();
        //     aggregateEmotions = arrayObject.object.emotions;
        //     aggregateActivities= arrayObject.object.activities;
        //   });
        //   console.log("aggregateEmotions");
        //   console.log(aggregateEmotions);
        //   console.log("aggregateActivities");
        //   console.log(aggregateActivities);
        // }
      },
      dataChanged: function (datadb) {
        var activityColors = 
        { "Sleep": {"colorShade": "Green", "colorType": "A200"},
          "Work" : {"colorShade": "Blue", "colorType": "A200"},
          "Gym" : {"colorShade": "Pink", "colorType": "A200"},
          "Social" : {"colorShade": "Amber", "colorType": "A200"},
          "Leisure": {"colorShade": "Purple", "colorType": "A200"}
        };
        var that = this;
        // do something when the query returns values
        console.log("---BEFORE");
        var data = this.datadb;
        var localDataAster = [];
        var colorSheet = this.$.colorSheet;
        data.forEach(function(childSnapshot) {
          console.log("my input");
          console.log(childSnapshot);
          // key will be "fred" the first time and "barney" the second time
          var activityLabel = childSnapshot.activityType;
          var startTime = childSnapshot.startTime;
          var endTime = childSnapshot.endTime;
          var colorShadeString = activityColors[activityLabel].colorShade;
          var activitySelectedColor = colorSheet.colors[colorShadeString].a700;
          that.$.picker.drawArcOnClock(startTime, endTime, activitySelectedColor);
        });
        console.log("AFTER");
      },
      createNewAggregateActivity: function() {
        this.newAggregateDetails = {};
        this.newAggregateDetails.emotions = {};
        for (var i=0; i<this.emotions.length;i++) {
          //TODO: WHY IS activity 0
          console.log(this.emotions[i]);
          this.newAggregateDetails.emotions[this.emotions[i]] = 0;
          // this.newAggregateDetails.emotions.push(emotionSelectedColor);
        }
        this.newAggregateDetails.activities = {};
        for (var i=0; i<this.activities.length;i++) {
          //TODO: WHY IS activity 0
          console.log(this.activities[i]);
          this.newAggregateDetails.activities[this.activities[i]] = 0;
          // this.newAggregateDetails.emotions.push(emotionSelectedColor);
        }
        console.log("createNewAggregateActivity");
        console.log(this.newAggregateDetails);
        this.updateAggregateDetails = this.newAggregateDetails;
        // this.aggregateDetails = this.newAggregateDetails;
      },
      _periodStartChanged: function(periodStartSelected) {
        
        },
      _angerScoreChanged: function(angerScore) {
        console.log("anger: "+this.angerScore);
        },
      _fearScoreChanged: function(fearScore) {
        console.log("fear: "+this.fearScore);
        },
      _sorrowScoreChanged: function(sorrowScore) {
        console.log("sorrow: "+this.sorrowScore);
        },
      _joyScoreChanged: function(joyScore) {
        console.log("joy: "+this.joyScore);
        },
      _calmScoreChanged: function(calmScore) {
        // console.log("calm: "+this.calmScore);
        },
      _hopeScoreChanged: function(hopeScore) {
        console.log("hope: "+this.hopeScore);
        },
      _activityListChanged: function(activityList) {
        console.log("activityList: "+this.activityList);
      },
      saveEntry: function() {  
        if (this.$.activityFirebase.isNew) {
          return this.$.activityFirebase.save(this.user+"/"+(new Date()).toDateString()).then(() => {
            this.$.activityFirebase.reset();
          });
        }
        return Promise.resolve();
      },
      createDayAggregate: function() {  
        console.log("creating new aggregate day");
        if (this.$.createAggregateFirebase.isNew) {
          return this.$.createAggregateFirebase.save(this.user+"/aggregate",(new Date()).toDateString()).then(() => {
            this.$.createAggregateFirebase.reset();
          });
        }
        return Promise.resolve();
      },
      updateNewDayAggregate: function() { 
      console.log("update new aggregate day"); 
        if (this.$.updateAggregateFirebase.isNew) {
          return this.$.updateAggregateFirebase.save(this.user+"/aggregate", (new Date()).toDateString()).then(() => {
            this.$.updateAggregateFirebase.reset();
          });
        }
        return Promise.resolve();
      },
      delete: function(key) {  
        if (this.$.deleteActivityFirebase.isNew) {
          this.pathDelete = this.user+"/"+(new Date()).toDateString()+"/"+key;
          return this.$.deleteActivityFirebase.destroy().then(() => {
            this.$.deleteActivityFirebase.reset();
          });
        }
        return Promise.resolve();
      },
      editOldEntry: function(key) {  
        if (this.$.editActivity.isNew) {
          return this.$.editActivity.save(this.user+"/"+(new Date()).toDateString(), key).then(() => {
            this.$.editActivity.reset();
          });
        }
        return Promise.resolve();
      },
      _activityChanged: function(activitySelected) {
        console.log("_activityChanged: "+this.activity)
        },
      _periodEndChanged: function(periodEndSelected) {
        console.log("MY-INPUT _periodEndChanged");
        this.createPopUp();
        },
      createPopUp: function() {
        this.$.plain.open();
      },
      _closePopUp: function() {
        console.log("close");
        this.$.plain.close();
        this.$.fearInput.reset();
        this.$.calmInput.reset();
        this.$.joyInput.reset();
        this.$.hopeInput.reset();
        this.$.angerInput.reset();
        this.$.sorrowInput.reset();
      },
      _saveSelection: function() {
        var activityColors = 
        { "Sleep": {"colorShade": "Green", "colorType": "A200"},
          "Work" : {"colorShade": "Blue", "colorType": "A200"},
          "Gym" : {"colorShade": "Pink", "colorType": "A200"},
          "Social" : {"colorShade": "Amber", "colorType": "A200"},
          "Leisure": {"colorShade": "Purple", "colorType": "A200"}
        };
        console.log("activity: " +this.activity);
        console.log("SAVE SELECTION");
        this.activityDetails.activityType = this.activity;
        this.activityDetails.startTime = this.periodStartSelected;
        this.activityDetails.endTime = this.periodEndSelected;
        this.activityDetails.duration = this.periodEndSelected - this.periodStartSelected;
        this.activityDetails.emotion = {};
        this.activityDetails.emotion.joy = this.joyScore;
        this.activityDetails.emotion.calm = this.calmScore;
        this.activityDetails.emotion.hope = this.hopeScore;
        this.activityDetails.emotion.anger = this.angerScore;
        this.activityDetails.emotion.fear = this.fearScore;
        this.activityDetails.emotion.sorrow = this.sorrowScore;
        this.activityDetails.emotion.total = this.joyScore + this.calmScore + this.hopeScore - this.angerScore - this.fearScore - this.sorrowScore;
        console.log("activityDetails: " +this.activityDetails);
        this.activityList.push(this.activityDetails);
        var activitySelected = this.activity;
        console.log("activitySelected: "+activitySelected);
        var colorShadeString = activityColors[activitySelected].colorShade;
        console.log("colorShadeString: "+colorShadeString);
        var activitySelectedColor = this.$.colorSheet.colors[colorShadeString].a700;
        this.$.picker.drawArcOnClock(this.periodStartSelected, this.periodEndSelected, activitySelectedColor);
        this.searchDb();
        
        console.log("newDayExists: "+this.newDayExists);
        if (!this.newDayExists) {
          this.createNewAggregateActivity();
        }
        // else {
        //   console.log("this.aggregateDetails: "+aggregateDetails);
        //   this.updateAggregateDetails = this.aggregateDetails;
        // }
        //updateAggregateActivity();
        console.log("BEFORE this.updateAggregateDetails.activities[this.activity]");
        console.log(this.updateAggregateDetails);
        console.log("this.updateAggregateDetails.activities[this.activity]");
        console.log(this.updateAggregateDetails.activities[this.activity]);
        console.log(parseInt(this.updateAggregateDetails.activities[this.activity]));
        console.log(this.activityDetails.duration);
        var newValue = parseInt(this.updateAggregateDetails.activities[this.activity]) + this.activityDetails.duration;
        console.log("newValue: "+newValue);
        console.log("updateAggregateDetails: ");
        console.log(this.updateAggregateDetails);
        var tempPlaceUpdateAggregateDetails = this.updateAggregateDetails;
        tempPlaceUpdateAggregateDetails.activities[this.activity] = parseInt(this.updateAggregateDetails.activities[this.activity]) + this.activityDetails.duration;
        console.log("AFTER this.updateAggregateDetails.activities[this.activity]");
        console.log(this.updateAggregateDetails.activities[this.activity]);
        tempPlaceUpdateAggregateDetails.emotions.joy = parseInt(this.updateAggregateDetails.emotions.joy) + this.joyScore;
        tempPlaceUpdateAggregateDetails.emotions.calm = parseInt(this.updateAggregateDetails.emotions.calm) + this.calmScore;
        tempPlaceUpdateAggregateDetails.emotions.hope = parseInt(this.updateAggregateDetails.emotions.hope) + this.hopeScore;
        tempPlaceUpdateAggregateDetails.emotions.anger = parseInt(this.updateAggregateDetails.emotions.anger) + this.angerScore;
        tempPlaceUpdateAggregateDetails.emotions.fear = parseInt(this.updateAggregateDetails.emotions.fear) + this.fearScore;
        tempPlaceUpdateAggregateDetails.emotions.sorrow = parseInt(this.updateAggregateDetails.emotions.sorrow) + this.sorrowScore;
        this.updateAggregateDetails = tempPlaceUpdateAggregateDetails;
        this.saveEntry();
        this.updateNewDayAggregate();

        this._closePopUp();
        this.joyScore = 0;
        this.calmScore = 0;
        this.hopeScore = 0;
        this.angerScore = 0;
        this.fearScore = 0;
        this.sorrowScore = 0;
      },
      updateAggregateActivity: function() {
        this.updateAggregateDetails.activities[this.activity] += this.activityDetails.duration;
        this.updateAggregateDetails.emotions.joy += this.joyScore;
        this.updateAggregateDetails.emotions.calm += this.calmScore;
        this.updateAggregateDetails.emotions.hope += this.hopeScore;
        this.updateAggregateDetails.emotions.anger += this.angerScore;
        this.updateAggregateDetails.emotions.fear += this.fearScore;
        this.updateAggregateDetails.emotions.sorrow += this.sorrowScore;
        this.updateNewDayAggregate();
      },
      searchDb: function() {
        console.log("SEARCH DB");
        console.log(this.datadb);
        for (key in this.datadb) {
          var obj = this.datadb[key];
          console.log("obj");
          console.log(obj);
          var activityStartTime = obj.startTime;
          var activityEndTime = obj.endTime;
          var modified = false;
          if (activityStartTime < this.periodEndSelected && activityEndTime > this.periodEndSelected) {
            //change start time of the old activity
            obj.startTime = this.periodEndSelected;
            console.log("MODIFYING START TIME");
            modified = true;
          }
          else if (activityStartTime < this.periodStartSelected && activityEndTime > this.periodStartSelected) {
            // change end time of old activity
            obj.endTime = this.periodStartSelected;
            console.log("MODIFYING END TIME");
            modified = true;
          }
          else if (activityEndTime <= this.periodEndSelected && activityStartTime >= this.periodStartSelected) {
            // delete this key
            var key = obj.$key;
            this.delete(key);
            console.log("DELETING");
          }

          if (modified) {
            console.log("obj");
            console.log(obj.emotion);
            this.editedActivityDetails.activityType = obj.activityType;
            this.editedActivityDetails.startTime = obj.startTime;
            this.editedActivityDetails.endTime = obj.endTime;
            this.editedActivityDetails.duration = obj.endTime - obj.startTime;
            this.editedActivityDetails.emotion = obj.emotion;
            console.log("editedActivityDetails");
            console.log(this.editedActivityDetails);
            var key = obj.$key;
            this.editOldEntry(key);
          }
        }
      },
      printEndValue: function() {
        console.log("printEndValue: "+this.periodEndSelected);
      },
      _onCircleButtonClick: function(event) {
        var node = this.$.orangeTriangle;
        console.log("_onCircleButtonClick");
        node.style.transform = 'scale(0,0)';
        if (node) {
          // node.animate();
          console.log("animating");
        }
      },
      _onCircleStopClick: function(event) {
        var node = this.$.orange;
        console.log("_onCircleStopClick");
        if (node) {
          console.log("cancelling animation");
          node.cancelAnimation();
        }
      }
    });

  </script>

</dom-module>

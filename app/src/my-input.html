<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="paper-time-picker.html">
<link rel="import" href="menu-overlay.html">
<link rel="import" href="paper-clock-selector.html">
<link rel="import" href="simple-menu.html">
<link rel="import" href="simple-menubar.html">
<link rel="import" href="my-animatable.html">
<link rel="import" href="my-animatable-triangle.html">
<link rel="import" href="my-icons.html">
<link rel="import" href="../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html">
<link rel="import" href="my-toolbar.html">
<link rel="import" href="my-login.html">
<link rel="import" href="colors-material.html">
<link rel="import" href="toolbar-behavior.html">
<link rel="import" href="../bower_components/note-app/common/note-app/na-editor.html">
<link rel="import" href="../bower_components/note-app/common/note-app/na-note.html">
<link rel="import" href="../bower_components/note-app/common/note-app/shared-styles.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<dom-module id="my-input">

  <template>

    <style include="note-app-shared-styles">
      :host {
        display: block;
        padding: 10px;
      }

    simple-menu,
    simple-menubar {
      display: inline-block;
      width: 100%;
    }

    simple-menu a {
      display: block;
    }

    simple-menubar a,
    simple-menu a {
      padding: 15px 20px;
      color: var(--primary-text-color);
      text-decoration: none;
    }

    p.heading {
      color: var(--app-primary-color);
      text-decoration: none;
      margin-bottom:0px;
    }

    simple-menu a[disabled],
    simple-menubar a[disabled] {
      color: var(--google-grey-300);
    }

    paper-button.sleep {
      background-color: white;
      border-style: solid;
      border-width: 1px;
      border-color: var(--paper-green-a700);
      color: var(--paper-green-a700);
      --paper-button-raised-keyboard-focus: {
        background-color: var(--paper-pink-a200) !important;
        color: white !important;
      };
    }

    paper-button.gym {
      background-color: white;
      color: var(--paper-pink-a700);
      border-style: solid;
      border-width: 1px;
      border-color: var(--paper-pink-a700);
      --paper-button-raised-keyboard-focus: {
        background-color: var(--paper-pink-a200) !important;
        color: white !important;
      };
    }

    paper-button.social {
      background-color: white;
      border-style: solid;
      border-width: 1px;
      border-color: var(--paper-amber-a700);
      color: var(--paper-amber-a700);
      --paper-button-raised-keyboard-focus: {
        background-color: var(--paper-pink-a200) !important;
        color: white !important;
      };
    }

    paper-button.leisure {
      background-color: white;
      border-style: solid;
      border-width: 1px;
      border-color: var(--paper-purple-a700);
      color: var(--paper-purple-a700);
      --paper-button-raised-keyboard-focus: {
        background-color: var(--paper-pink-a200) !important;
        color: white !important;
      };
    }

    paper-button.work {
      background-color: white;
      border-style: solid;
      border-width: 1px;
      border-color: var(--paper-blue-a700);
      color: var(--paper-blue-a700);
    }
    
    paper-button.sleep[active] {
      background-color: var(--paper-red-700);
    }

    .horizontal-section {
      padding: 0;
      margin-bottom: 20px;
    }

    .row {
      height: 100px;
    }

    .menuitem-floating {
      float:left; 
      display:inline;
      margin: 20px;
    }

    .with-margin {
          margin: 24px 40px;
        }

    .scrollable {
          border: 1px solid lightgray;
          padding: 24px;
          @apply(--layout-scroll);
        }
    </style>

    <div id="scope">
            <paper-time-picker id="picker" period-start-selected="{{periodStartSelected}}" period-end-selected="{{periodEndSelected}}"></paper-time-picker>
            <paper-button class="work">Work</paper-button>
<paper-button class="sleep">Sleep</paper-button>
<paper-button class="gym">Gym</paper-button>
<paper-button class="social">Social</paper-button>
<paper-button class="leisure">Leisure</paper-button>
    </div>


<!-- 
    <paper-fab
        on-tap=""
        label="Wo">
    </paper-fab> -->
    <firebase-query
        id="query"
        app-name="notes"
        path="/"
        data="{{data}}">
    </firebase-query>

    <app-indexeddb-mirror
        session="[[user.uid]]"
        key="notes"
        data="{{data}}"
        persisted-data="{{persistedData}}">
    </app-indexeddb-mirror>

    <div class="notes">
      <p>heelo out</p>
      <template is="dom-repeat" items="[[data]]" as="note">
        <p>heelo</p>
        <na-note
            id$="[[note.$key]]"
            title="[[note.title]]"
            body="[[note.body]]"
            on-tap="edit">
        </na-note>
      </template>
    </div>
    <paper-fab
        icon="add"
        on-tap="create"
        disabled="[[!online]]"
        aria-label="Add note">
    </paper-fab>

    <firebase-document
        id="document"
        app-name="notes"
        path="/"
        data="[[editableNote]]">
    </firebase-document>

    <firebase-document
        id="activityFirebase"
        app-name="notes"
        path="/heelo/"
        data="{{activityDetails}}">
    </firebase-document>

    <na-editor
        id="editor"
        note="{{editableNote}}"
        on-close="commitChange">
    </na-editor>

    <!-- <my-animatable-triangle id="orangeTriangle" on-tap="_onPressedAnimationTriangle" on-track="_onPressedAnimationTriangle"></my-animatable-triangle> -->
    <colors-material id="colorSheet"></colors-material>
    <menu-overlay id="plain" tabindex="-1" class="with-margin scrollable">
    <div style="padding-bottom: 40px;">    
      <paper-icon-button icon="icons:close" style="float: left;" on-tap="_closePopUp"></paper-icon-button>
      <paper-icon-button icon="icons:check" style="float: right;" on-tap="_saveSelection"></paper-icon-button>
    </div>
    <div class="scrollable">
      <p style="text-align: center;">{{periodStartSelected}} pm to {{periodEndSelected}} pm</p>
      <p class="heading">Select Activity</p><hr style="margin-bottom:20px;">
      <div class="horizontal-section-container">
        <div>
          <div class="row">
            <div class="horizontal-section">
              <simple-menubar selected="{{activity}}" id="activitySelection" attr-for-selected="name" fallback-selection="Work">
                <a role="menuitem" name="Work">Work</a>
                <a role="menuitem" name="Sleep">Sleep</a>
                <a role="menuitem" name="Gym">Gym</a>
                <a role="menuitem" name="Social">Social</a>
                <a role="menuitem" name="Leisure">Leisure</a>
              </simple-menubar>
            </div>
          </div>
        </div>
      </div>
      <p class="heading">Select Emotion</p><hr style="margin-bottom:20px;">
      <div>
      <my-animatable class="menuitem-floating" emotion="Joy" score={{joyScore}}></my-animatable>
      <my-animatable class="menuitem-floating" emotion="Hope" score={{hopeScore}}></my-animatable>
      <my-animatable class="menuitem-floating" emotion="Calm" score={{calmScore}}></my-animatable>
      </div>
      <div>
      <my-animatable-triangle class="menuitem-floating" emotion="Sorrow" score={{sorrowScore}}></my-animatable-triangle>
      <my-animatable-triangle class="menuitem-floating" emotion="Fear" score={{fearScore}}></my-animatable-triangle>
      <my-animatable-triangle id="orange" class="menuitem-floating" emotion="Anger" score={{angerScore}}></my-animatable>
      </div>
    </div>
    </menu-overlay>

  </template>

  <script>

    Polymer({

      is: 'my-input',

      behaviors: [
        Polymer.NoteAppBehavior
      ],

      properties: {
          periodEndSelected: {
            type: Number,
            value: 0,
            notify: true,
            observer: '_periodEndChanged' 
          },
          periodStartSelected: {
            type: Number,
            value: 0,
            notify: true,
            observer: '_periodStartChanged' 
          },
          activity: {
            type: String,
            reflectToAttribute: true,
            observer: '_activityChanged' 
          },
          activityDetails: {
            type: Object,
            reflectToAttribute: true
          },
          activityList: {
            type: Array,
            value: [],
            observer: '_activityListChanged' 
          },
          joyScore: {
            type: Number,
            value: 0,
            observer: '_joyScoreChanged'
          },
          hopeScore: {
            type: Number,
            value: 0,
            observer: '_hopeScoreChanged'
          },
          calmScore: {
            type: Number,
            value: 0,
            observer: '_calmScoreChanged'
          },
          fearScore: {
            type: Number,
            value: 0,
            observer: '_fearScoreChanged'
          },
          sorrowScore: {
            type: Number,
            value: 0,
            observer: '_sorrowScoreChanged'
          },
          angerScore: {
            type: Number,
            value: 0,
            observer: '_angerScoreChanged'
          },
          angerScore: {
            type: Number,
            value: 0,
            observer: '_angerScoreChanged'
          },
      },
      _periodStartChanged: function(periodStartSelected) {
        
        },
      _angerScoreChanged: function(angerScore) {
        console.log("anger: "+this.angerScore);
        },
      _fearScoreChanged: function(fearScore) {
        console.log("fear: "+this.fearScore);
        },
      _sorrowScoreChanged: function(sorrowScore) {
        console.log("sorrow: "+this.sorrowScore);
        },
      _joyScoreChanged: function(joyScore) {
        console.log("joy: "+this.joyScore);
        },
      _calmScoreChanged: function(calmScore) {
        console.log("calm: "+this.calmScore);
        },
      _hopeScoreChanged: function(hopeScore) {
        console.log("hope: "+this.hopeScore);
        },
      _activityListChanged: function(activityList) {
        console.log("activityList: "+this.activityList);
      },
      saveEntry: function() {  
        if (this.$.activityFirebase.isNew) {
          return this.$.activityFirebase.save((new Date()).toDateString()).then(() => {
            this.$.activityFirebase.reset();
          });
        }
        return Promise.resolve();
      },
      _activityChanged: function(activitySelected) {
        console.log("_activityChanged: "+this.activity)
        },
      createFabDialog: function() {
        console.log("createFabDialog");
        this.$.editor.open();
        },
      _periodEndChanged: function(periodEndSelected) {
        console.log("MY-INPUT _periodEndChanged");
        this.createPopUp();
        },
      createPopUp: function() {
        this.$.plain.open();
      },
      _closePopUp: function() {
        console.log("close");
        this.$.plain.close();
      },
      _saveSelection: function() {
        var activityColors = 
        { "Sleep": {"colorShade": "Green", "colorType": "A200"},
          "Work" : {"colorShade": "Blue", "colorType": "A200"},
          "Gym" : {"colorShade": "Pink", "colorType": "A200"},
          "Social" : {"colorShade": "Amber", "colorType": "A200"},
          "Leisure": {"colorShade": "Purple", "colorType": "A200"}
        };
        console.log("activity: " +this.activity);
        this.activityDetails.activityType = this.activity;
        this.activityDetails.startTime = this.periodStartSelected;
        this.activityDetails.endTime = this.periodEndSelected;
        this.activityDetails.emotion = {};
        this.activityDetails.emotion.joy = this.joyScore;
        this.activityDetails.emotion.calm = this.calmScore;
        this.activityDetails.emotion.hope = this.hopeScore;
        this.activityDetails.emotion.anger = this.angerScore;
        this.activityDetails.emotion.fear = this.fearScore;
        this.activityDetails.emotion.sorrow = this.sorrowScore;
        console.log("activityDetails: " +this.activityDetails);
        this.activityList.push(this.activityDetails);
        var activitySelected = this.activity;
        console.log("activitySelected: "+activitySelected);
        var colorShadeString = activityColors[activitySelected].colorShade;
        console.log("colorShadeString: "+colorShadeString);
        var activitySelectedColor = this.$.colorSheet.colors[colorShadeString].a700;
        this.$.picker.drawArcOnClock(this.periodStartSelected, this.periodEndSelected, activitySelectedColor);
        this.saveEntry();
        this._closePopUp();
      },
      printEndValue: function() {
        console.log("printEndValue: "+this.periodEndSelected);
      },
      _onPressedAnimationTriangle: function(event) {
        var node = this.$.orangeTriangle;
        console.log("_onPressedAnimation");
        var st = window.getComputedStyle(node, null);
        var transformValues = st.getPropertyValue("-webkit-transform") ||
         st.getPropertyValue("-moz-transform") ||
         st.getPropertyValue("-ms-transform") ||
         st.getPropertyValue("-o-transform") ||
         st.getPropertyValue("transform") ||
         "Either no transform set, or browser doesn't do getComputedStyle";
        console.log("transformValues: "+transformValues);
        var values = transformValues.split('(')[1];
        values = values.split(')')[0];
        values = values.split(',');
        var scale = values[0];
        var scaleNew = ((parseFloat(scale)+0.01)*100%100)/100;
        scaleNew += 0.3;
        console.log('scaleNew: '+scaleNew);
        node.style.transform = 'scale('+scaleNew+','+scaleNew+')';
        if (node) {
          // node.animate();
          console.log("animating");
        }
      },
      _onCircleButtonClick: function(event) {
        var node = this.$.orangeTriangle;
        console.log("_onCircleButtonClick");
        node.style.transform = 'scale(0,0)';
        if (node) {
          // node.animate();
          console.log("animating");
        }
      },
      _onCircleStopClick: function(event) {
        var node = this.$.orange;
        console.log("_onCircleStopClick");
        if (node) {
          console.log("cancelling animation");
          node.cancelAnimation();
        }
      }
    });

  </script>

</dom-module>
